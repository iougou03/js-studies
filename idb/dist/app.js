(()=>{"use strict";let e,t;const o=new WeakMap,n=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap;let c={get(e,t,o){if(e instanceof IDBTransaction){if("done"===t)return n.get(e);if("objectStoreNames"===t)return e.objectStoreNames||r.get(e);if("store"===t)return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return d(e[t])},set:(e,t,o)=>(e[t]=o,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i(s){return"function"==typeof s?(a=s)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...e){return a.apply(l(this),e),d(o.get(this))}:function(...e){return d(a.apply(l(this),e))}:function(e,...t){const o=a.call(l(this),e,...t);return r.set(o,e.sort?e.sort():[e]),d(o)}:(s instanceof IDBTransaction&&function(e){if(n.has(e))return;const t=new Promise(((t,o)=>{const n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),n()},s=()=>{o(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));n.set(e,t)}(s),i=s,(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>i instanceof e))?new Proxy(s,c):s);var a,i}function d(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,o)=>{const n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(d(e.result)),n()},s=()=>{o(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),a.set(t,e),t}(e);if(s.has(e))return s.get(e);const t=i(e);return t!==e&&(s.set(e,t),a.set(t,e)),t}const l=e=>a.get(e);function u(e,t,{blocked:o,upgrade:n,blocking:r,terminated:s}={}){const a=indexedDB.open(e,t),c=d(a);return n&&a.addEventListener("upgradeneeded",(e=>{n(d(a.result),e.oldVersion,e.newVersion,d(a.transaction))})),o&&a.addEventListener("blocked",(()=>o())),c.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),c}const p=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],g=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(g.get(t))return g.get(t);const o=t.replace(/FromIndex$/,""),n=t!==o,r=f.includes(o);if(!(o in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!p.includes(o))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[o](...t),r&&s.done]))[0]};return g.set(t,s),s}var m;m=c,c={...m,get:(e,t,o)=>b(e,t)||m.get(e,t,o),has:(e,t)=>!!b(e,t)||m.has(e,t)};const h={demo1:function(){u("db1",1,{upgrade(e){e.createObjectStore("store1"),e.createObjectStore("store2")}}),u("db2",1,{upgrade(e){e.createObjectStore("store3",{keyPath:"id"}),e.createObjectStore("store4",{autoIncrement:!0})}})},demo2:async function(){const e=await u("db1",1);e.add("store1","hello world","message"),e.add("store1",!0,"delivered"),e.close()},demo3:async function(){const e=await u("db1",1);e.add("store1","hello again!!","new message").then((e=>{console.log("success!",e)})).catch((e=>{console.error("error: ",e)})),e.close()},demo4:async function(){const e=await u("db2",1);e.add("store3",{id:"cat001",strength:10,speed:10}),e.add("store3",{id:"cat002",strength:11,speed:9}),e.add("store4",{id:"cat003",strength:8,speed:12}),e.add("store4",{id:"cat004",strength:12,speed:13}),e.close()},demo5:async function(){const e=await u("db2",1);e.get("store3","cat001").then(console.log),e.getAll("store3").then(console.log),e.count("store3").then(console.log),e.getAllKeys("store3").then(console.log),e.close()},demo6:async function(){const e=await u("db1",1);e.put("store1",!1,"delivered"),e.close();const t=await u("db2",1);t.put("store3",{id:"cat001",strength:99,speed:99}),t.close()},demo7:async function(){const e=await u("db2",1);let t=e.transaction(["store3","store4"],"readwrite"),o=await t.objectStore("store3").get("cat001");t.objectStore("store3").delete("cat001"),t.objectStore("store4").add(o),e.close()},demo8:async function(){const e=await u("db1",1);let t=e.transaction("store2","readwrite");t.store.add("foo","foo"),t.store.add("bar","bar"),t.done.then((()=>{console.log("All steps succeeded, changes committed!")})).catch((()=>{console.error("Something went wrong, transaction aborted")})),e.close()}};for(const e in h){const t=document.createElement("button");t.textContent=e,t.addEventListener("click",h[e]),document.body.appendChild(t)}})();